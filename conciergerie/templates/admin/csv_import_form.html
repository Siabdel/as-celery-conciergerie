{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block breadcrumbs %}
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">{% trans "Home" %}</a></li>
      <li class="breadcrumb-item"><a href="{% url 'admin:conciergerie_reservation_changelist' %}">{% trans "Reservations" %}</a></li>
      <li class="breadcrumb-item active">{% trans "Import CSV" %}</li>
    </ol>
  </nav>
{% endblock %}

{% block content %}
  <div class="container mt-4">
    <div class="row justify-content-center">
      <div class="col-12 col-md-6 col-lg-5">

        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0"><i class="bi bi-cloud-upload"></i> {% trans "Import de réservations CSV" %}</h4>
          </div>

          <div class="card-body">
            <!-- Messages -->
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              {% endfor %}
            {% endif %}

            <!-- Formulaire -->
            <form method="post" enctype="multipart/form-data" id="csvForm">
              {% csrf_token %}

              <!-- Fichier -->
              <div class="mb-3">
                <label for="id_csv_file" class="form-label fw-bold">{% trans "Sélectionner un fichier CSV" %}</label>
                <input type="file"
                       name="csv_file"
                       class="form-control"
                       accept=".csv"
                       required
                       id="id_csv_file">
                <div class="form-text">{% trans "Colonne attendue : Date, Arrivée au plus tard le, Date de début, Date de fin, Nuits, Voyageur, Property, Devise, Montant, Versé, Frais de service, Frais de paiement rapide, Frais de ménage, Frais pour le linge de maison, Revenus bruts" %}</div>
              </div>

              <!-- Bouton -->
              <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg" id="submitBtn">
                  <i class="bi bi-check-circle"></i> {% trans "Importer" %}
                </button>
              </div>

              <!-- Spinner (facultatif) -->
              <div class="text-center mt-3 d-none" id="spinner">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">{% trans "Import en cours, veuillez patienter..." %}</p>
              </div>
            </form>
          </div>

          <div class="card-footer text-muted text-center">
            <small>{% trans "Le fichier ne doit pas dépasser 10 Mo" %}</small>
          </div>
        </div>

        <!-- Lien retour -->
        <div class="text-center mt-3">
          <a href="{% url 'admin:conciergerie_reservation_changelist' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> {% trans "Retour à la liste" %}
          </a>
        </div>

      </div>
    </div>
  </div>
{% endblock %}

{% block extrajs %}
<script>
  // Petit JS pour afficher le spinner pendant l'upload
  document.getElementById('csvForm').addEventListener('submit', function () {
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('spinner').classList.remove('d-none');
  });
</script>
{% endblock %}
