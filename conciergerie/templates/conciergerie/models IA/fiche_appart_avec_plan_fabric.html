<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fiche Bien - Conciergerie Pro</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Ic√¥nes -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <!-- Vue.js 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Fabric.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <style>
    :root {
      --color-primary: #FF6B35;
      --color-secondary: #005E9B;
      --color-light: #FFFFFF;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
    }
    .hero-header {
      background: linear-gradient(120deg, var(--color-secondary), #004a7a);
      color: white;
      padding: 2rem 0;
    }
    .property-card {
      border-left: 4px solid var(--color-primary);
      box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
    }
    .carousel-control {
      background: rgba(0,0,0,0.3);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      top: 50%;
      transform: translateY(-50%);
    }
    #floorPlanCanvas {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background: #f8f9fa;
    }
    #map-container {
      height: 300px;
      border-radius: 8px;
      overflow: hidden;
    }
    .btn-primary {
      background-color: var(--color-primary);
      border-color: var(--color-primary);
    }
    .btn-secondary {
      background-color: var(--color-secondary);
      border-color: var(--color-secondary);
    }
    .feature-badge {
      background-color: rgba(255, 107, 53, 0.1);
      color: var(--color-primary);
    }
    footer a {
      color: var(--color-secondary);
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<div id="app">
  <!-- Header -->
  <header class="hero-header mb-4">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="h3 mb-2">{{ property.titre }}</h1>
          <p class="mb-1"><i class="bi bi-geo-alt me-2"></i> {{ property.adresse }}</p>
          <div class="d-flex flex-wrap gap-2 mt-2">
            <span class="badge bg-light text-dark">{{ property.type }}</span>
            <span class="badge bg-light text-dark">{{ property.surface }} m¬≤</span>
            <span class="badge bg-light text-dark">{{ property.pieces }} pi√®ces</span>
          </div>
        </div>
        <div class="col-md-4 text-md-end mt-3 mt-md-0">
          <div class="h4 mb-1">{{ property.prix }} ‚Ç¨</div>
          <button class="btn btn-light">üìÖ Visite</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container mb-5">
    <div class="row g-4">
      <!-- Galerie Photos -->
      <div class="col-lg-7">
        <div class="card property-card">
          <div class="card-body">
            <div id="photoCarousel" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-inner">
                <div v-for="(photo, index) in property.photos" :key="index" 
                     class="carousel-item" :class="{ active: index === 0 }">
                  <img :src="photo.url" class="d-block w-100" 
                       style="height: 400px; object-fit: cover;" 
                       :alt="'Photo ' + (index+1)"
                       @click="openLightbox(index)">
                </div>
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#photoCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#photoCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
              </button>
            </div>
            <div class="d-flex justify-content-center mt-2">
              <div v-for="(photo, index) in property.photos" 
                   :key="index" 
                   class="mx-1" 
                   @click="setCurrentSlide(index)"
                   style="cursor: pointer;">
                <img :src="photo.thumb || photo.url" 
                     class="img-thumbnail" 
                     style="width: 60px; height: 40px; object-fit: cover;"
                     :class="{ 'border-primary border-2': index === currentSlide }">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- D√©tails du bien -->
      <div class="col-lg-5">
        <div class="card property-card h-100">
          <div class="card-body">
            <h3 class="card-title h5">D√©tails du bien</h3>
            <div class="row mb-3">
              <div class="col-sm-6 mb-2">
                <small class="text-muted">Propri√©taire</small>
                <div class="fw-medium">{{ property.owner.nom }}</div>
              </div>
              <div class="col-sm-6 mb-2">
                <small class="text-muted">T√©l√©phone</small>
                <div class="fw-medium">{{ property.owner.tel }}</div>
              </div>
              <div class="col-sm-6 mb-2">
                <small class="text-muted">√âtage</small>
                <div class="fw-medium">{{ property.etage }}</div>
              </div>
              <div class="col-sm-6 mb-2">
                <small class="text-muted">Charges</small>
                <div class="fw-medium">{{ property.charges }} ‚Ç¨/mois</div>
              </div>
            </div>

            <h4 class="h6 mt-3">Caract√©ristiques</h4>
            <div class="d-flex flex-wrap gap-1 mb-3">
              <span v-for="feature in property.caracteristiques" 
                    :key="feature" 
                    class="badge feature-badge">{{ feature }}</span>
            </div>

            <div class="mt-3">
              <h4 class="h6">Description</h4>
              <p class="small">{{ property.description }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Localisation -->
      <div class="col-12">
        <div class="card property-card">
          <div class="card-body">
            <h3 class="card-title h5 mb-3">Localisation</h3>
            <div class="row g-4">
              <div class="col-lg-7">
                <div id="map-container"></div>
              </div>
              <div class="col-lg-5">
                <div class="d-flex align-items-start">
                  <i class="bi bi-building fs-4 text-primary me-3"></i>
                  <div>
                    <h4 class="h6 mb-1">Immeuble</h4>
                    <p class="small mb-2">{{ property.immeuble.nom }}<br>
                    {{ property.immeuble.adresse }}</p>
                  </div>
                </div>
                <div class="d-flex align-items-start mt-3">
                  <i class="bi bi-people fs-4 text-primary me-3"></i>
                  <div>
                    <h4 class="h6 mb-1">Gestionnaire</h4>
                    <p class="small mb-1">{{ property.gestionnaire.nom }}</p>
                    <a :href="'tel:' + property.gestionnaire.tel" class="small text-decoration-none">
                      üìû {{ property.gestionnaire.tel }}
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Plan de l'√©tage (Fabric.js) -->
      <div class="col-12">
        <div class="card property-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3 class="card-title h5 mb-0">Plan de l'√©tage</h3>
              <div>
                <button class="btn btn-sm btn-outline-secondary me-2" @click="zoomIn">
                  <i class="bi bi-zoom-in"></i>
                </button>
                <button class="btn btn-sm btn-outline-secondary me-2" @click="zoomOut">
                  <i class="bi bi-zoom-out"></i>
                </button>
                <button class="btn btn-sm btn-outline-primary" @click="resetView">
                  <i class="bi bi-arrow-clockwise"></i> R√©initialiser
                </button>
              </div>
            </div>
            
            <div class="mb-3 bg-light p-2 rounded">
              <small v-if="selectedRoom">
                <strong>{{ selectedRoom.nom }}</strong> - {{ selectedRoom.surface }} m¬≤
                <span v-if="selectedRoom.description"> | {{ selectedRoom.description }}</span>
              </small>
              <small v-else>S√©lectionnez une pi√®ce pour voir les d√©tails</small>
            </div>

            <div class="text-center">
              <canvas id="floorPlanCanvas" width="800" height="400"></canvas>
            </div>
            
            <div class="mt-3">
              <h4 class="h6">L√©gende des pi√®ces</h4>
              <div class="d-flex flex-wrap gap-2">
                <div v-for="room in property.plan" :key="room.id" class="d-flex align-items-center">
                  <div class="me-2" :style="{ 
                    width: '20px', 
                    height: '20px', 
                    backgroundColor: room.fill, 
                    border: '1px solid ' + room.stroke 
                  }"></div>
                  <small>{{ room.nom }} ({{ room.surface }} m¬≤)</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Lightbox pour zoom photo -->
  <div class="modal fade" id="photoLightbox" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Vue agrandie</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <img :src="currentPhotoUrl" class="img-fluid" alt="Vue agrandie">
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-light text-center py-4 border-top">
    <div class="container">
      <p class="mb-1">
        <a href="#">Mentions l√©gales</a> | 
        <a href="#">Contact</a> | 
        <a href="#">Support</a> | 
        <a href="#">CGV</a>
      </p>
      <p class="text-muted small mb-0">&copy; 2025 ConciergeriePro. Tous droits r√©serv√©s.</p>
    </div>
  </footer>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;

const app = createApp({
  setup() {
    const currentSlide = ref(0);
    const currentPhotoIndex = ref(0);
    const selectedRoom = ref(null);
    const canvas = ref(null);
    const fabricCanvas = ref(null);
    let zoomLevel = 1;

    // Fake data (propri√©t√©s du bien)
    const property = ref({
      id: 1,
      titre: "Appartement Moderne Centre-Ville",
      adresse: "15 Rue de la R√©publique, 69002 Lyon",
      type: "Appartement",
      surface: 85,
      pieces: 3,
      etage: 3,
      charges: 120,
      prix: "345 000",
      description: "Magnifique appartement neuf avec vue d√©gag√©e. Cuisine √©quip√©e moderne, parquet massif, baies vitr√©es. Proche des commodit√©s, transports et √©coles.",
      
      owner: {
        nom: "M. Dupont",
        tel: "+33 6 12 34 56 78"
      },
      
      caracteristiques: [
        "Balcon", "Cuisine √©quip√©e", "Parquet", 
        "Double vitrage", "Cave", "Parking"
      ],
      
      photos: [
        { url: "https://picsum.photos/800/600?random=1", thumb: "https://picsum.photos/100/75?random=1" },
        { url: "https://picsum.photos/800/600?random=2", thumb: "https://picsum.photos/100/75?random=2" },
        { url: "https://picsum.photos/800/600?random=3", thumb: "https://picsum.photos/100/75?random=3" },
        { url: "https://picsum.photos/800/600?random=4", thumb: "https://picsum.photos/100/75?random=4" }
      ],
      
      plan: [
        { 
          id: 1, 
          nom: "Salon", 
          surface: 28, 
          fill: "rgba(255, 107, 53, 0.3)", 
          stroke: "#FF6B35",
          description: "√âclair√© par une grande baie vitr√©e",
          points: [
            { x: 100, y: 50 },
            { x: 350, y: 50 },
            { x: 350, y: 200 },
            { x: 100, y: 200 }
          ]
        },
        { 
          id: 2, 
          nom: "Cuisine", 
          surface: 12, 
          fill: "rgba(0, 94, 155, 0.3)", 
          stroke: "#005E9B",
          description: "√âquip√©e Siemens avec √Ælot central",
          points: [
            { x: 370, y: 50 },
            { x: 470, y: 50 },
            { x: 470, y: 150 },
            { x: 370, y: 150 }
          ]
        },
        { 
          id: 3, 
          nom: "Chambre 1", 
          surface: 16, 
          fill: "rgba(46, 139, 87, 0.3)", 
          stroke: "#2E8B57",
          description: "Avec dressing int√©gr√©",
          points: [
            { x: 100, y: 220 },
            { x: 220, y: 220 },
            { x: 220, y: 320 },
            { x: 100, y: 320 }
          ]
        },
        { 
          id: 4, 
          nom: "Chambre 2", 
          surface: 14, 
          fill: "rgba(147, 112, 219, 0.3)", 
          stroke: "#9370DB",
          description: "Avec vue sur cour int√©rieure",
          points: [
            { x: 240, y: 220 },
            { x: 350, y: 220 },
            { x: 350, y: 320 },
            { x: 240, y: 320 }
          ]
        },
        { 
          id: 5, 
          nom: "Salle de bain", 
          surface: 8, 
          fill: "rgba(255, 165, 0, 0.3)", 
          stroke: "#FFA500",
          description: "Douche √† l'italienne",
          points: [
            { x: 370, y: 170 },
            { x: 440, y: 170 },
            { x: 440, y: 250 },
            { x: 370, y: 250 }
          ]
        },
        { 
          id: 6, 
          nom: "WC", 
          surface: 3, 
          fill: "rgba(128, 128, 128, 0.3)", 
          stroke: "#808080",
          description: "Avec lave-mains",
          points: [
            { x: 370, y: 270 },
            { x: 410, y: 270 },
            { x: 410, y: 310 },
            { x: 370, y: 310 }
          ]
        }
      ],
      
      immeuble: {
        nom: "R√©sidence Bellecour",
        adresse: "15 Rue de la R√©publique, 69002 Lyon"
      },
      
      gestionnaire: {
        nom: "Conciergerie Pro",
        tel: "+33 4 72 12 34 56"
      },
      
      coords: [45.764043, 4.835659]
    });

    const currentPhotoUrl = computed(() => {
      return property.value.photos[currentPhotoIndex.value]?.url || '';
    });

    const setCurrentSlide = (index) => {
      currentSlide.value = index;
      $('.carousel').carousel(index);
    };

    const openLightbox = (index) => {
      currentPhotoIndex.value = index;
      new bootstrap.Modal(document.getElementById('photoLightbox')).show();
    };

    // Initialisation cartographique
    const initMap = () => {
      if (!property.value.coords) return;
      
      const map = L.map('map-container').setView(property.value.coords, 16);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
      }).addTo(map);

      L.marker(property.value.coords).addTo(map)
        .bindPopup(`<b>${property.value.titre}</b><br>${property.value.adresse}`)
        .openPopup();
    };

    // Initialisation Fabric.js pour le plan
    const initFloorPlan = () => {
      const canvasEl = document.getElementById('floorPlanCanvas');
      fabricCanvas.value = new fabric.Canvas('floorPlanCanvas', {
        selection: false,
        backgroundColor: '#f8f9fa'
      });

      // Dessiner les pi√®ces
      property.value.plan.forEach(room => {
        const points = room.points.map(p => new fabric.Point(p.x, p.y));
        const polygon = new fabric.Polygon(points, {
          fill: room.fill,
          stroke: room.stroke,
          strokeWidth: 2,
          selectable: false,
          hoverCursor: 'pointer',
          roomId: room.id
        });

        // Ajouter texte centr√©
        const centerX = points.reduce((sum, p) => sum + p.x, 0) / points.length;
        const centerY = points.reduce((sum, p) => sum + p.y, 0) / points.length;
        
        const text = new fabric.Text(room.nom, {
          left: centerX,
          top: centerY,
          fontSize: 12,
          fill: '#333',
          fontWeight: 'bold',
          originX: 'center',
          originY: 'center',
          selectable: false
        });

        fabricCanvas.value.add(polygon);
        fabricCanvas.value.add(text);
        
        // Gestion du clic
        polygon.on('mousedown', () => {
          selectRoom(room);
        });
      });

      fabricCanvas.value.renderAll();
    };

    const selectRoom = (room) => {
      selectedRoom.value = room;
      
      // Effet visuel de s√©lection
      fabricCanvas.value.getObjects().forEach(obj => {
        if (obj.stroke === '#333') {
          obj.set('stroke', property.value.plan.find(r => r.id === obj.roomId)?.stroke || '#000');
        }
      });
      
      fabricCanvas.value.getObjects().forEach(obj => {
        if (obj.roomId === room.id) {
          obj.set('stroke', '#333');
          obj.set('strokeWidth', 3);
        }
      });
      
      fabricCanvas.value.renderAll();
    };

    const zoomIn = () => {
      zoomLevel += 0.2;
      fabricCanvas.value.setZoom(zoomLevel);
    };

    const zoomOut = () => {
      if (zoomLevel > 0.4) {
        zoomLevel -= 0.2;
        fabricCanvas.value.setZoom(zoomLevel);
      }
    };

    const resetView = () => {
      zoomLevel = 1;
      fabricCanvas.value.setZoom(1);
      fabricCanvas.value.viewportTransform = [1, 0, 0, 1, 0, 0];
    };

    onMounted(() => {
      initMap();
      initFloorPlan();
      
      // Initialisation carousel
      new bootstrap.Carousel('#photoCarousel', {
        interval: false
      });
    });

    return {
      property,
      currentSlide,
      currentPhotoIndex,
      currentPhotoUrl,
      selectedRoom,
      setCurrentSlide,
      openLightbox,
      zoomIn,
      zoomOut,
      resetView
    };
  }
});

app.mount('#app');
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>